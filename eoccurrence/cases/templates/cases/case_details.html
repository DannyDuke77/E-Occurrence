{% extends "core/base.html" %}

{% block title %}Case {{ case.case_number }} Details{% endblock %}

{% block content %}
    <div class="flex justify-between items-center mb-6 px-4">
        <!-- Back to previous page -->
        <a href="{% url 'cases:view_cases' %}" class="inline-block px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Back to Cases</a>
    </div>
    {% if messages %}
        <div class="mb-6">
            {% for message in messages %}
                <div class="p-3 rounded-lg shadow-sm text-sm font-semibold
                    {% if message.tags == 'error' %}bg-red-100 text-red-800 border border-red-300
                    {% elif message.tags == 'success' %}bg-green-100 text-green-900 border border-green-300
                    {% else %}bg-gray-100 text-gray-800 border border-gray-300{% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <div class="max-w-6xl mx-auto bg-white rounded-2xl shadow-lg overflow-hidden">
    <!-- Header -->
        <div class="bg-blue-600 text-white px-6 py-4 flex justify-between items-center">
            <div>
                <h2 class="text-2xl font-bold">Case #{{ case.case_number }}</h2>
                <p class="text-sm opacity-90">{{ case.title }}</p>
            </div>

            <div>
                <p class="text-sm font-semibold text-gray-200">Recorded By: </p>
                <a href="{% url 'accounts:profile_view' case.recorded_by.profile.uuid %}"
                    class="text-sm font-semibold text-white hover:underline underline-offset-2"
                    title="{{ case.recorded_by.first_name }} {{ case.recorded_by.last_name }}">
                    {{ case.recorded_by.first_name }} {{ case.recorded_by.last_name }}
                </a>

            </div>
        </div>

    <!-- Details -->
        <div class="p-6 space-y-4">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <p class="text-sm font-semibold text-gray-500">Complainant</p>
                    <p class="text-lg font-medium">{{ case.complainant.first_name }} {% if case.complainant.last_name %}{{ case.complainant.last_name }}{% endif %}</p>
                </div>
                <div>
                    <p class="text-sm font-semibold text-gray-500">Location</p>
                    <p class="text-lg">{{ case.location }}</p>
                </div>
            </div>

            <div>
                <p class="text-sm font-semibold text-gray-500">Description</p>
                <p class="leading-relaxed">{{ case.description }}</p>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-5 gap-4">
                <div>
                    <p class="text-sm font-semibold text-gray-500">Incident Date</p>
                    <p>{{ case.incident_date|date:"F j, Y" }}</p>
                </div>
                
                <div>
                    <p class="text-sm font-semibold text-gray-500">Report Date</p>
                    <p>{{ case.report_date|date:"F j, Y" }}</p>
                </div>
                
                <div>
                    <p class="text-sm font-semibold text-gray-500">Case Status</p>
                    <span class="inline-block px-3 py-1 text-sm font-bold rounded-full text-white
                        {% if case.status == 'open' %}bg-green-600
                        {% elif case.status == 'closed' %}bg-red-600
                        {% elif case.status == 'under_investigation' %}bg-yellow-500
                        {% elif case.status == 'in_court' %}bg-purple-600
                        {% elif case.status == 'pending' %}bg-blue-600
                        {% else %}bg-gray-500{% endif %}">
                        {{ case.status|title }}
                    </span>
                </div>

                {% if case.court_date %}
                    <div>
                        <p class="text-sm font-semibold text-gray-500">Court Date</p>
                        <p>{{ case.court_date|date:"F j, Y" }}</p>
                    </div>
                {% else %}
                    <div>
                        <p class="text-sm font-semibold text-gray-500">Court Date</p>
                        <p class="text-gray-500">Not Scheduled</p>
                    </div>
                {% endif %}

                <div>
                    <p class="text-sm font-semibold text-gray-500">Bail Status</p>
                    <span class="inline-block px-3 py-1 text-sm font-bold rounded-full text-white
                        {% if case.bail_decision == 'pending' %}bg-yellow-500
                        {% elif case.bail_decision == 'granted' %}bg-green-600
                        {% elif case.bail_decision == 'denied' %}bg-red-600
                        {% else %}bg-gray-500{% endif %}">
                        {{ case.bail_decision|title }}
                    </span>
                </div>

                <div>
                    <p class="text-sm font-semibold text-gray-500">Last Updated</p>
                    <p>{{ case.updated_at|date:"F j, Y, g:i a" }}</p>
                </div>
            </div>
        </div>

        <hr class="border-gray-500">

    <!-- Actions -->
        <div class="bg-gray-50 px-6 py-4">
            <h2 class="text-2xl font-bold mb-4 text-indigo-800">Actions</h2>
            <div class="flex justify-start space-x-4 font-semibold">
                <a href="{% url 'cases:edit_case' case.uuid %}" class="inline-block px-4 py-2 bg-indigo-800 text-white rounded hover:bg-indigo-600">Edit Case</a>

                {% if user.is_authenticated and user.profile.user_role == 'admin' or user.profile.user_role == 'court' and case.status == 'pending' and case.status == 'open' %}
                    <a href="{% url 'cases:republic_court_decision' case.uuid %}" class="inline-block px-4 py-2 bg-amber-500 text-white rounded hover:bg-red-800">Court Decision</a>
                {% endif %}

                {% if user.is_authenticated and user.profile.user_role == 'admin' %}
                    <a href="#" class="inline-block px-4 py-2 bg-red-600 text-white rounded hover:bg-red-800">Delete Case</a>
                {% endif %}
            </div>
        </div>

        <hr class="border-gray-500 my-6">

    <!-- Witnesses and Suspects Section -->
        <div class="p-6 grid grid-cols-1 sm:grid-cols-2 gap-6">
            <div class="space-y-4 shadow-sm">
                <div class="bg-blue-600 text-white px-6 py-4 flex justify-between items-center rounded-t-lg">
                    <div>
                        <h2 class="text-2xl font-bold">Witnesses</h2>
                        <p class="text-sm opacity-90">Total: {{ case.witnesses.count }}</p>
                    </div>

                    <div>
                        <a href="{% url 'cases:witness_entry' case.uuid %}" class="text-sm font-semibold text-white hover:underline underline-offset-2">Add Witness</a>
                    </div>
                </div>

                <div class="bg-white px-2 pb-4 pt-2 rounded-b-lg shadow-xl">
                    <ul class="bg-white rounded-b-lg space-y-2">
                        {% for witness in case.witnesses.all %}
                            <li>
                                <!-- Number the witnesses -->
                                <span class="text-gray-500">{{ forloop.counter }}.</span>
                                <a href="#" class="text-gray-800 hover:underline underline-offset-2 font-medium">{{ witness.name }} - {{ witness.statement |truncatechars:50 }}</a>
                            </li>
                        {% empty %}
                            <li class="text-gray-500">No witnesses added yet.</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <div class="space-y-4 shadow-sm">
                <div class="bg-blue-600 text-white px-6 py-4 flex justify-between items-center rounded-t-lg">
                    <div>
                        <h2 class="text-2xl font-bold">Suspects</h2>
                        <p class="text-sm opacity-90">Total: {{ case.suspects.count }}</p>
                    </div>

                    <div>
                        <a href="{% url 'cases:suspect_entry' case.uuid %}" class="text-sm font-semibold text-white hover:underline underline-offset-2">Add Suspect</a>
                    </div>
                </div>

                <div class="bg-white px-2 pb-4 pt-2 rounded-b-lg shadow-xl">
                    <ul class="bg-white rounded-b-lg space-y-2">
                        {% for suspect in case.suspects.all %}
                            <li>
                                <!-- Number the suspects -->
                                <span class="text-gray-500">{{ forloop.counter }}.</span>
                                <a href="#" class="text-gray-800 hover:underline underline-offset-2 font-medium">{{ suspect.name }} - {{ suspect.contact_info |truncatechars:50 }}</a>
                            </li>
                        {% empty %}
                            <li class="text-gray-500">No suspects added yet.</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

