{% extends "core/base.html" %}

{% block title %}Admin Dashboard{% endblock %}
{% load static %}

{% block content %}
<div class="p-6 space-y-8">
    <!-- Page header -->
    <div class="flex items-center justify-between">
        <h1 class="text-2xl font-bold text-gray-800">Admin Dashboard</h1>
        <a href="{% url 'admin:index' %}"
           class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-lg shadow hover:bg-indigo-700" target="_blank">
            Go to Django Admin
        </a>
    </div>

    <!-- Quick stats -->
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6">
        <div class="bg-white rounded-xl shadow p-4 text-center">
            <p class="text-sm text-gray-500">Total Users</p>
            <p class="text-2xl font-bold text-indigo-600">{{ total_users }}</p>
        </div>
        <div class="bg-white rounded-xl shadow p-4 text-center">
            <p class="text-sm text-gray-500">Active Users</p>
            <p class="text-2xl font-bold text-green-600">{{ active_users }}</p>
        </div>
        <div class="bg-white rounded-xl shadow p-4 text-center">
            <p class="text-sm text-gray-500">Open Cases</p>
            <p class="text-2xl font-bold text-red-600">{{ open_cases }}</p>
        </div>
        <div class="bg-white rounded-xl shadow p-4 text-center">
            <p class="text-sm text-gray-500">Closed Cases</p>
            <p class="text-2xl font-bold text-gray-700">{{ closed_cases }}</p>
        </div>
        <div class="bg-white rounded-xl shadow p-4 text-center">
            <p class="text-sm text-gray-500">Pending Support</p>
            <p class="text-2xl font-bold text-yellow-600">{{ pending_support }}</p>
        </div>
    </div>

    <!-- Recent activity -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Recent cases -->
        <div class="bg-white rounded-xl shadow p-6">
            <h2 class="text-lg font-semibold mb-4">Recent Cases</h2>
            <ul class="divide-y divide-gray-300">
                {% for case in recent_cases %}
                <li class="py-2">
                    <a href="{% url 'cases:case_details' case.uuid %}" class="font-medium text-blue-600 hover:underline">{{ case.title }}</a>
                    <p class="text-sm text-gray-500">Status: {{ case.status }} | {{ case.created_at|date:"M d, Y H:i" }}</p>
                </li>
                {% empty %}
                <li class="py-2 text-gray-500">No cases available.</li>
                {% endfor %}
            </ul>
        </div>

        <!-- Recent support requests -->
        <div class="bg-white rounded-xl shadow p-6">
            <h2 class="text-lg font-semibold mb-4">Recent Support Requests</h2>
            <ul class="divide-y divide-gray-200">
                {% for req in recent_support %}
                <li class="py-2">
                    <span class="flex items-center justify-between font-medium text-gray-800">{{ req.message|truncatechars:50 }}
                        <p class="text-sm text-gray-500 "><p class="font-bold px-2 py-1 text-sm rounded-full 
                        {% if req.status == 'pending' %} 
                            bg-yellow-300 text-yellow-700 
                        {% elif req.status == 'resolved' %} 
                            bg-green-400 text-green-800 
                        {% else %} 
                            bg-red-300 text-red-800 
                        {% endif %}">
                        {{ req.status|title }}</p>
                    </span>
                    <p class="text-sm text-gray-500">Sent: {{ req.created_at|date:"M d, Y H:i" }}</p>
                </li>
                {% empty %}
                <li class="py-2 text-gray-500">No support requests available.</li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Recent court decisions -->
        <div class="bg-white rounded-xl shadow p-6">
            <h2 class="text-lg font-semibold mb-4">Recent Court Decisions</h2>
            <ul class="divide-y divide-gray-300">
                {% for decision in recent_decisions %}
                <li class="py-2">
                    <p class="font-medium text-gray-800">{{ decision.case.title }}</p>
                    <p class="text-sm text-gray-500">{{ decision.outcome }} | {{ decision.decision_date|date:"M d, Y" }}</p>
                </li>
                {% empty %}
                <li class="py-2 text-gray-500">No court decisions available.</li>
                {% endfor %}
            </ul>
        </div>

        <!-- Recent users -->
        <div class="bg-white rounded-xl shadow p-6">
            <h2 class="text-lg font-semibold mb-4">Recent Users</h2>
            <ul class="divide-y divide-gray-300">
                {% for user in recent_users %}
                <li class="py-2">
                    <a href="{% url 'accounts:profile_view' user.profile.uuid %}" class="font-medium text-blue-600 hover:underline">{{ user.first_name }} {{ user.last_name }} <span class="text-gray-400 text-sm block">@{{ user.username }}</span></a>
                    <p class="text-sm text-gray-500">Joined: {{ user.date_joined|date:"M d, Y H:i" }}</p>
                </li>
                {% empty %}
                <li class="py-2 text-gray-500">No new users.</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endblock %}
